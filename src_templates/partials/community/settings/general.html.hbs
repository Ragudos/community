<h1 class="title-sm">General</h1>
<hr>
{{#if (eq community.owner_id user._id)}}
<div>
    {{> partials/templates/input_with_counter}}
    <form data-loading-aria-busy id="rename-form" class="form-rename" data-loading-path="/community/api/rename" data-loading-delay="50"
        hx-post="/community/api/rename" hx-target-error="#nothing">
        <div class="input-group">
            <input-with-counter data-max-count="60">
                <label slot="label" for="community_name">Community name</label>
                <input data-loading-disable slot="input" placeholder="The name of your community" name="community_name" id="community_name"
                    aria-errormessage="community_name_error" value="{{community.display_name}}" maxlength="60"
                    minlength="3" required pattern="[a-zA-z0-9À-ž\s]+" />
            </input-with-counter>
            <span id="community_name_error"></span>
        </div>
        <input type="hidden" name="community_id" value="{{community.community_id}}" hidden />
        <input type="hidden" name="authenticity_token" value="{{authenticity_token}}" hidden />
        <input type="text" name="honeypot" value="" hidden />
        <button disabled id="rename-submit" type="submit" class="btn" data-loading-disable>
            <span data-loading-class="hidden">Rename</span>
            <span data-loading>Renaming...</span>
        </button>
    </form>
    <script>
        const input = document.getElementById("community_name");
        input.addEventListener("input", (evt) => {
            if (document.getElementById("rename-form").classList.contains("htmx-request")) {
                return;
            }

            if (input.value != input.defaultValue) {
                document.getElementById("rename-submit").removeAttribute("disabled");
            } else {
                document.getElementById("rename-submit").setAttribute("disabled", "true");
            }
        });
    </script>
</div>
{{/if}}
<div class="subhead">
    <h2 class="title-xs">Danger Zone</h2>
</div>
<div class="danger-zone">
    <ul>
        {{#if (eq community.owner_id user._id)}}
        <li>
            <div>
                <strong>Change how people can join</strong>
                {{#if community.is_private}}
                <div>This community is currently private.</div>
                {{else}}
                <div>This community is currently public.</div>
                {{/if}}
            </div>
            <details class="dropdown">
                <summary class="destructive" aria-label="A menu dropdown for changing the process how users join to this community.">
                    <div>Change who can join</div>
                </summary>
                <div class="dropdown-wrapper" id="change-join-process-dropdown">
                    <div>
                        <button aria-expanded="false" type="button" class="destructive"
                            aria-controls="change-join-process-confirmation" onclick="openDialog(this)">
                            Change to
                            {{#if community.is_private}}
                            public
                            {{else}}
                            private
                            {{/if}}
                        </button>
                    </div>
                </div>
            </details>
        </li>
        <li>
            <div>
                <strong>Delete this community</strong>
                <div>Once you delete a community, there is no going back. Please be certain.</div>
            </div>
            <button aria-expanded="false" type="button" aria-controls="delete-confirmation" onclick="openDialog(this)"
                class="destructive">Delete Community</button>
        </li>
        {{/if}}
        {{#if (not (eq community.owner_id user._id))}}
        <li>
            <div>
                <strong>Leave community</strong>
                <div>Once you leave a private community, you must submit another join request. Please be certain.</div>
            </div>
            <button aria-expanded="false" type="button" aria-controls="leave-confirmation" onclick="openDialog(this)"
                class="destructive">Leave Community</button>
        </li>
        {{/if}}
    </ul>
    {{#if (eq community.owner_id user._id)}}
    <dialog aria-modal="true" id="change-join-process-confirmation" class="scale-up">
        <div>
            <div class="overlay-header">
                <h1 class="title-xs">
                    Make {{community.display_name}}
                    {{#if community.is_private}}
                    public
                    {{else}}
                    private
                    {{/if}}
                </h1>
            </div>
            <div class="overlay-content">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                </svg>
                <p class="title-md">{{community.display_name}}</p>
            </div>
            <form>
                <button type="submit" class="destructive">
                    I want to make this community
                    {{#if community.is_private}}
                    public
                    {{else}}
                    private
                    {{/if}}
                </button>
            </form>
        </div>
    </dialog>
    <dialog aria-modal="true" id="delete-confirmation" class="scale-up">
        <div>
            <div class="overlay-header">
                <h1 class="title-xs">Delete {{community.display_name}}</h1>
            </div>
            <div class="overlay-content">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                </svg>
                <p class="title-md">{{community.display_name}}</p>
            </div>
            <form>
                <button type="submit" class="destructive">
                    I want to delete this community
                </button>
            </form>
        </div>
    </dialog>
    {{/if}}
    {{#if (not (eq community.owner_id user._id))}}
    <dialog aria-modal="true" id="leave-confirmation" class="scale-up">
        <div>
            <div class="overlay-header">
                <h1 class="title-xs">Leave {{community.display_name}}</h1>
            </div>
            <div class="overlay-content">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                </svg>
                <p class="title-md">{{community.display_name}}</p>
            </div>
            <form>
                <button type="submit" class="destructive">
                    I want to leave this community
                </button>
            </form>
        </div>
    </dialog>
    {{/if}}
</div>